(function(e){function t(t){for(var o,c,i=t[0],a=t[1],u=t[2],d=0,f=[];d<i.length;d++)c=i[d],s[c]&&f.push(s[c][0]),s[c]=0;for(o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o]);l&&l(t);while(f.length)f.shift()();return r.push.apply(r,u||[]),n()}function n(){for(var e,t=0;t<r.length;t++){for(var n=r[t],o=!0,i=1;i<n.length;i++){var a=n[i];0!==s[a]&&(o=!1)}o&&(r.splice(t--,1),e=c(c.s=n[0]))}return e}var o={},s={app:0},r=[];function c(t){if(o[t])return o[t].exports;var n=o[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,c),n.l=!0,n.exports}c.m=e,c.c=o,c.d=function(e,t,n){c.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},c.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.t=function(e,t){if(1&t&&(e=c(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(c.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)c.d(n,o,function(t){return e[t]}.bind(null,o));return n},c.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return c.d(t,"a",t),t},c.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},c.p="/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],a=i.push.bind(i);i.push=t,i=i.slice();for(var u=0;u<i.length;u++)t(i[u]);var l=a;r.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"034f":function(e,t,n){"use strict";var o=n("85ec"),s=n.n(o);s.a},1:function(e,t){},"12d7":function(e,t,n){},3585:function(e,t,n){},"56d7":function(e,t,n){"use strict";n.r(t);n("cadf"),n("551c"),n("f751"),n("097d");var o=n("2b0e"),s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("div",{attrs:{id:"nav"}},[n("router-link",{staticClass:"button is-outlined",attrs:{to:"/"}},[e._v("Auth")]),e.isAuthenticated?n("router-link",{staticClass:"button is-outlined",attrs:{to:"/chat"}},[e._v("Chat")]):e._e()],1),e.isAuthenticated?n("div",[n("h3",[e._v(" Logged In As : "+e._s(e.username)+" ")])]):e._e(),n("router-view")],1)},r=[],c=n("cebc"),i=n("2f62"),a={computed:Object(c["a"])({},Object(i["b"])(["isAuthenticated","getToken","username"])),created:function(){this.fetchUser()},methods:{fetchUser:function(){this.$store.dispatch("fetchUser",this.$router)}}},u=a,l=(n("034f"),n("2877")),d=Object(l["a"])(u,s,r,!1,null,null,null),f=d.exports,g=n("8c4f"),m=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",{staticClass:"google"},[e.isAuthenticated?e._e():n("g-signin-button",{style:{margin:"20px"},attrs:{params:e.googleSignInParams},on:{success:e.onGoogleSignInSuccess,error:e.onGoogleSignInError}},[e._v("Sign in with Google")]),e.isAuthenticated?n("button",{on:{click:function(t){return e.onGoogleSignOut()}}},[e._v("signOut")]):e._e()],1),n("div",{staticClass:"facebook"},[e.isAuthenticated?e._e():n("fb-signin-button",{attrs:{params:e.fbSignInParams},on:{success:e.onFacebookSignInSuccess,error:e.onFacebookSignInError}},[e._v("Sign in with Facebook")])],1)])},h=[],p=(n("96cf"),n("3b8d")),b=n("7618"),S=n("795b"),v=n.n(S),k=n("4f76"),_=n.n(k),E=n("a3ad"),O=n.n(E);o["a"].use(O.a),o["a"].use(_.a);var w={name:"auth",data:function(){return{googleSignInParams:{client_id:"631684094252-riivbvb0f9664f5qc2ivnepmf48mdvr9.apps.googleusercontent.com"},fbSignInParams:{scope:"public_profile,email",return_scopes:!0}}},computed:Object(c["a"])({},Object(i["b"])({isSocketConnected:"isSocketConnected",isAuthenticated:"isAuthenticated"})),created:function(){this.connectToWebSocket()},mounted:function(){var e=document.createElement("script");e.setAttribute("src","https://apis.google.com/js/api:client.js"),document.head.appendChild(e),window.fbAsyncInit=function(){window.FB.init({appId:"258196488419311",cookie:!0,xfbml:!0,version:"v2.8"})},function(e,t,n){var o,s=e.getElementsByTagName(t)[0];e.getElementById(n)||(o=e.createElement(t),o.id=n,o.src="//connect.facebook.net/en_US/sdk.js",s.parentNode.insertBefore(o,s))}(document,"script","facebook-jssdk")},watch:{isAuthenticated:function(){this.connectToWebSocket()}},methods:{onGoogleSignInSuccess:function(e){var t=this.$router,n=e.getAuthResponse().id_token;this.$store.dispatch("onHandleGoogleSignin",{idToken:n,router:t})},onGoogleSignInError:function(e){console.log("OH NOES",e)},onGoogleSignOut:function(){var e=window.gapi.auth2.getAuthInstance();e&&e.isSignedIn.get()&&e.signOut().then(function(){console.log("User signed out.")}),this.$store.dispatch("resetLoggedInUser")},onFacebookSignInSuccess:function(e){var t=this.$router;try{if(e){var n=e.accessToken||e.authResponse.accessToken,o=e.authResponse.userID;this.$store.dispatch("onHandleFacebookSignin",{accessToken:n,userID:o,router:t})}}catch(s){console.log(s)}},onFacebookSignInError:function(e){console.log("OH NOES",e)},isConnectedToFacebook:function(){return new v.a(function(e){if(void 0===("undefined"===typeof window?"undefined":Object(b["a"])(window)))return e(!1);var t=window.FB;return t&&t.getLoginStatus(function(t){if("connected"===t.status)return e(!0)}),e(!1)})},onFacebookSignOut:function(){var e=Object(p["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=3,this.isConnectedToFacebook();case 3:if(!e.sent){e.next=6;break}window.FB.logout(function(){console.log("User signed out.")}),this.$store.dispatch("resetLoggedInUser");case 6:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),connectToWebSocket:function(){this.$store.dispatch("setupChatSocket")}}},I=w,U=(n("7c2d"),Object(l["a"])(I,m,h,!1,null,null,null)),T=U.exports,C=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("b-container",[n("div",{staticClass:"row"},[n("div",{staticClass:"col-md-4 col-sm-12"},[n("b-list-group",{staticClass:"user-card"},e._l(e.allUsers,function(t){return n("user-card",{key:t.id,attrs:{user:t,isSelected:e.selected&&e.selected.id===t.id}})}),1)],1),e.selected?n("div",{staticClass:"chat-area col-md-8 col-sm-12"},[n("div",{staticClass:"msg-area",attrs:{id:"msg-area"}},e._l(e.messages,function(t){return n("div",{key:t.id,class:{right:e.isRight(t),left:e.isleft(t)}},[e._v("\n        "+e._s(t.message)+"\n        ")])}),0),n("b-form",{staticClass:"container2",on:{submit:function(t){return t.preventDefault(),e.onSubmit(t)}}},[n("b-form-group",{staticClass:"chat-input"},[n("b-form-input",{attrs:{id:"chat-submit",name:"message"},model:{value:e.message,callback:function(t){e.message=t},expression:"message"}})],1),n("div",{staticClass:"submit-buttons"},[n("button",{staticClass:"btn btn-success",attrs:{type:"submit"}},[e._v("send")])])],1)],1):e._e()])])},j=[],A=n("1520"),y=n.n(A),R=n("5a5e"),x=n.n(R),L=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("b-list-group-item",{staticClass:"card",class:{active:e.isSelected},staticStyle:{cursor:"pointer"},on:{click:function(t){return e.changeSelectedUser()}}},[n("img",{staticClass:"card__img",attrs:{src:e.user.profile||"https://user-images.githubusercontent.com/16608864/35882949-bbe13aa0-0bab-11e8-859c-ceda3b213818.jpeg",alt:""}}),n("div",{staticClass:"username"},[e._v("\n      "+e._s(e.user.username)+"\n  ")])])},N=[],G=n("5ac8"),P=n.n(G),$={props:{user:{type:Object,required:!0},isSelected:{type:Boolean,required:!1}},components:{"b-list-group-item":P.a},data:function(){return{isActive:!1,active1:{"background-color":"yellow"}}},methods:{changeSelectedUser:function(){this.isActive=!0,this.$store.dispatch("setSelectedUser",this.user)}}},D=$,M=(n("b523"),Object(l["a"])(D,L,N,!1,null,"ebca6f3a",null)),F=M.exports,B=n("0596"),H=n.n(B),W=n("d239"),K=n.n(W),V=n("4216"),q=n.n(V),J={name:"chat",components:{"b-container":y.a,"b-list-group":x.a,"user-card":F,"b-form":H.a,"b-form-group":K.a,"b-form-input":q.a},data:function(){return{message:null}},computed:Object(c["a"])({},Object(i["b"])({allUsers:"allUsers",selected:"selected",allMessages:"allMessages",userId:"userId",username:"username"}),{messages:function(){var e=this;return this.allMessages.filter(function(t){return t.toUserId===e.selected.id||t.fromUserId===e.selected.id})}}),created:function(){this.connectToWebSocket()},methods:{onSubmit:function(){this.$store.dispatch("handleMessage",{fromUserId:this.userId,message:this.message,toUserId:this.selected.id,fromUserName:this.username,toUserName:this.selected.username}),this.message="",this.$nextTick(function(){var e=document.getElementById("msg-area");e.scrollTop=e.scrollHeight})},isleft:function(e){return e.fromUserId===this.selected.id},isRight:function(e){return e.toUserId===this.selected.id},connectToWebSocket:function(){this.$store.dispatch("setupChatSocket")}}},z=J,Q=(n("9c66"),Object(l["a"])(z,C,j,!1,null,null,null)),X=Q.exports;o["a"].use(g["a"]);var Y,Z=new g["a"]({mode:"history",base:"/",routes:[{path:"/",name:"auth",component:T},{path:"/chat",name:"chat",component:X}]}),ee=n("bd86"),te=n("92d3"),ne=n.n(te),oe=n("ff8c"),se=oe["a"].API_URL,re=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:se,t=ne.a.create({baseURL:e,headers:{"Access-Control-Allow-Origin":"*"},timeout:1e4}),n=function(e){t.headers.authorization=e},o=function(e){return t.post("auth/google-sign-up",{idtoken:e}).then(function(e){return e.data})},s=function(e){var n=e.accessToken,o=e.userID;return t.post("auth/facebook-sign-up",{accessToken:n,userID:o}).then(function(e){return e.data})},r=function(e){return n(e),t.get("auth/me").then(function(e){return e.data})};return{onHandleGoogleSignin:o,onHandleFacebookSignin:s,fetchMe:r}},ce=re,ie=n("9fb0"),ae=ce(),ue={state:{loggedInUser:{},isAuthenticated:!1,token:null,username:null,userId:null},getters:{isAuthenticated:function(e){return e.isAuthenticated},getToken:function(e){return e.token},userId:function(e){return e.userId},username:function(e){return e.username}},mutations:(Y={},Object(ee["a"])(Y,ie["c"],function(e,t){e.loggedInUser=t,e.userId=t.id,e.username=t.username}),Object(ee["a"])(Y,ie["a"],function(e){e.loggedInUser={},e.userId=null,e.username=null}),Object(ee["a"])(Y,ie["b"],function(e,t){e.isAuthenticated=t}),Object(ee["a"])(Y,ie["f"],function(e,t){e.token=t}),Y),actions:{onHandleGoogleSignin:function(){var e=Object(p["a"])(regeneratorRuntime.mark(function e(t,n){var o,s,r,c;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return o=n.idToken,s=n.router,e.next=3,ae.onHandleGoogleSignin(o);case 3:r=e.sent;try{r&&localStorage&&(c=r.token,localStorage.setItem("token",c),t.commit(ie["f"],c),delete r.token&&delete r.isEmailVerified,t.commit(ie["c"],r),t.commit(ie["b"],!0),s.push({path:"/chat"}))}catch(i){console.log(i)}case 5:case"end":return e.stop()}},e)}));function t(t,n){return e.apply(this,arguments)}return t}(),onHandleFacebookSignin:function(){var e=Object(p["a"])(regeneratorRuntime.mark(function e(t,n){var o,s,r;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return o=n.router,e.next=3,ae.onHandleFacebookSignin(n);case 3:s=e.sent;try{s&&localStorage&&(r=s.token,localStorage.setItem("token",r),t.commit(ie["f"],r),delete s.token&&delete s.isEmailVerified,t.commit(ie["c"],s),t.commit(ie["b"],!0),o.push({path:"/chat"}))}catch(c){console.log(c)}case 5:case"end":return e.stop()}},e)}));function t(t,n){return e.apply(this,arguments)}return t}(),resetLoggedInUser:function(){var e=Object(p["a"])(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:t.commit(ie["a"]),t.commit(ie["b"],!1),t.commit(ie["f"],null),n=localStorage.getItem("token"),n&&localStorage.removeItem("token");case 5:case"end":return e.stop()}},e)}));function t(t){return e.apply(this,arguments)}return t}(),fetchUser:function(){var e=Object(p["a"])(regeneratorRuntime.mark(function e(t,n){var o,s,r;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(o=n.router,s=localStorage.getItem("token"),t.commit(ie["f"],s),!s){e.next=16;break}return e.prev=4,e.next=7,ae.fetchMe(s);case 7:r=e.sent,t.commit(ie["c"],r),t.commit(ie["b"],!0),e.next=16;break;case 12:e.prev=12,e.t0=e["catch"](4),console.log(e.t0),o.push({path:"/auth"});case 16:case"end":return e.stop()}},e,null,[[4,12]])}));function t(t,n){return e.apply(this,arguments)}return t}()}},le=n("f406"),de={state:{selected:null},getters:{selected:function(e){return e.selected}},mutations:Object(ee["a"])({},ie["d"],function(e,t){e.selected=t}),actions:{setSelectedUser:function(e,t){var n=e.commit;n(ie["d"],t)}}};o["a"].use(i["a"]);var fe=new i["a"].Store({modules:{auth:ue,socket:le["a"],chat:de}}),ge=fe,me=n("9f7b"),he=n.n(me);o["a"].use(he.a),o["a"].config.productionTip=!1,new o["a"]({router:Z,store:ge,render:function(e){return e(f)}}).$mount("#app")},"7c2d":function(e,t,n){"use strict";var o=n("12d7"),s=n.n(o);s.a},"85ec":function(e,t,n){},"9c66":function(e,t,n){"use strict";var o=n("3585"),s=n.n(o);s.a},"9fb0":function(e,t,n){"use strict";n.d(t,"g",function(){return o}),n.d(t,"e",function(){return s}),n.d(t,"j",function(){return r}),n.d(t,"i",function(){return c}),n.d(t,"l",function(){return i}),n.d(t,"k",function(){return a}),n.d(t,"h",function(){return u}),n.d(t,"c",function(){return l}),n.d(t,"a",function(){return d}),n.d(t,"b",function(){return f}),n.d(t,"f",function(){return g}),n.d(t,"d",function(){return m});var o="SET_WEBSOCKET",s="SET_SOCKET_ON_CONNECTION",r="UPDATE_IS_CONNECTED",c="UPDATE_ALL_USERS",i="UPDATE_MESSAGE_TABLE_ON_SEND",a="UPDATE_MESSAGE_TABLE_ON_RECIEVE",u="UPDATE_ALL_MESSAGE",l="SET_LOGGED_IN_USER",d="RESET_LOGGED_IN_USER",f="SET_IS_AUTHENTICATED",g="SET_TOKEN",m="SET_SELECTED_USER"},b523:function(e,t,n){"use strict";var o=n("de6f"),s=n.n(o);s.a},de6f:function(e,t,n){},f406:function(e,t,n){"use strict";(function(e){var o,s=n("bd86"),r=n("8055"),c=n.n(r),i=n("ff8c"),a=n("9fb0"),u=n("2b0e"),l={webSocket:null,isConnected:!1,isSocketConnected:!1,allUsers:[],messages:[]},d={webSocket:function(e){return e.webSocket},isSocketConnected:function(e){return e.isSocketConnected},allCategories:function(e){return e.allCategories},allUsers:function(e){return e.allUsers},allMessages:function(e){return e.messages}},f={setupChatSocket:function(t){var n=t.commit,o=t.dispatch,s=t.state,r=t.rootState;if(!s.webSocket&&e.browser){var u="".concat(i["a"].SOCKET_URL,"/?token=").concat(encodeURIComponent(r.auth.token)),l=c()(u);l.on("ALL_USERS",function(e){n(a["i"],e)}),l.on("ALL_MESSAGES",function(e){n(a["h"],e)}),l.on("message",function(e){n(a["k"],e)}),n(a["g"],l),l.on("disconnect",function(){n(a["e"],!1)}),l.on("connect",function(){n(a["e"],!0),l.emit("join")})}else s.webSocket&&(s.webSocket.disconnect(!0),window.setTimeout(function(){n(a["g"],null),o("setupChatSocket")},500))},handleMessage:function(e,t){var n=e.commit,o=e.state;o.webSocket&&(n(a["l"],t),o.webSocket.emit("message",t))}},g=(o={},Object(s["a"])(o,a["g"],function(e,t){e.webSocket=t}),Object(s["a"])(o,a["e"],function(e,t){e.isSocketConnected=t}),Object(s["a"])(o,a["j"],function(e,t){e.isConnected=t}),Object(s["a"])(o,a["i"],function(e,t){e.allUsers=t}),Object(s["a"])(o,a["k"],function(e,t){u["a"].set(e.messages,e.messages.length,t)}),Object(s["a"])(o,a["l"],function(e,t){u["a"].set(e.messages,e.messages.length,t)}),Object(s["a"])(o,a["h"],function(e,t){e.messages=t}),o);t["a"]={state:l,getters:d,actions:f,mutations:g}}).call(this,n("4362"))},ff8c:function(e,t,n){"use strict";t["a"]={API_URL:Object({NODE_ENV:"production",BASE_URL:"/"}).API_URL||"https://chat-msg-app.herokuapp.com/api/",SOCKET_URL:"https://chat-msg-app.herokuapp.com"}}});
//# sourceMappingURL=app.ee9290d2.js.map